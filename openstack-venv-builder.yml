
# OpenStack upstream virtualenv builder
# =====================================

---
clusters: 

  - name: seed 
    images: images/venv-builder/
    services:
        - name: seed
          image: shaddock/generic-pyvenv-builder:latest
          priority: 0

  - name: venv-builder
    hosts: !include hosts/all.yml
    vars:
      git_branch: 'stable/newton'
    images: images/venv-builder/

    services:       
        - name: nova-builder
          image: shaddock/generic-pyvenv-builder:latest
          priority: 20
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          env:
            GIT_URL: https://github.com/openstack/nova.git
            GIT_BRANCH: '{{ git_branch }}'

        - name: glance-builder
          image: shaddock/generic-pyvenv-builder:latest
          priority: 20
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          env:
            GIT_URL: https://github.com/openstack/glance.git
            GIT_BRANCH: '{{ git_branch }}'
        
        - name: keystone-builder
          image: shaddock/generic-pyvenv-builder:latest
          priority: 20
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          env:
            GIT_URL: https://github.com/openstack/keystone.git
            GIT_BRANCH: '{{ git_branch }}'
        
        - name: cinder-builder
          image: shaddock/generic-pyvenv-builder:latest
          priority: 20
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          env:
            GIT_URL: https://github.com/openstack/cinder.git
            GIT_BRANCH: '{{ git_branch }}'
        
        - name: neutron-builder
          image: shaddock/generic-pyvenv-builder:latest
          priority: 20
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          env:
            GIT_URL: https://github.com/openstack/neutron.git
            GIT_BRANCH: '{{ git_branch }}'
        
        - name: horizon-builder
          image: shaddock/generic-pyvenv-builder:latest
          priority: 20
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          env:
            GIT_URL: https://github.com/openstack/horizon.git
            GIT_BRANCH: '{{ git_branch }}'
        
        - name: novaclient-builder
          image: shaddock/generic-pyvenv-builder:latest
          priority: 10
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          env:
            GIT_URL: https://github.com/openstack/python-novaclient.git
            GIT_BRANCH: '{{ git_branch }}'
        
        - name: glanceclient-builder
          image: shaddock/generic-pyvenv-builder:latest
          priority: 10
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          env:
            GIT_URL: https://github.com/openstack/python-glanceclient.git
            GIT_BRANCH: '{{ git_branch }}'
        
        - name: keystoneclient-builder
          image: shaddock/generic-pyvenv-builder:latest
          priority: 10
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          env:
            GIT_URL: https://github.com/openstack/python-keystoneclient.git
            GIT_BRANCH: '{{ git_branch }}'
        
        - name: cinderclient-builder
          image: shaddock/generic-pyvenv-builder:latest
          priority: 10
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          env:
            GIT_URL: https://github.com/openstack/python-cinderclient.git
            GIT_BRANCH: '{{ git_branch }}'
        
        - name: neutronclient-builder
          image: shaddock/generic-pyvenv-builder:latest
          priority: 10
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          env:
            GIT_URL: https://github.com/openstack/python-neutronclient.git
            GIT_BRANCH: '{{ git_branch }}'
        
        - name: openstackclient-builder
          image: shaddock/generic-pyvenv-builder:latest
          priority: 10
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          env:
            GIT_URL: https://github.com/openstack/python-openstackclient.git
            GIT_BRANCH: '{{ git_branch }}'
        
        - name: heat-builder
          image: shaddock/generic-pyvenv-builder:latest
          priority: 20
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          env:
            GIT_URL: https://github.com/openstack/heat.git
            GIT_BRANCH: '{{ git_branch }}'



  - name: post-build
    images: images/venv-builder/
    services:
        - name: symlink-creator
          image: shaddock/symlink-creator:latest
          priority: 30
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          depends-on:
            - {name: glanceclient, status: stopped, retry: 40}
            - {name: keystoneclient, status: stopped, retry: 40}
            - {name: openstackclient, status: stopped, retry: 40}
            - {name: novaclient, status: stopped, retry: 40}
            - {name: cinderclient, status: stopped, retry: 40}
            - {name: neutronclient, status: stopped, retry: 40}
            - {name: glance, status: stopped, retry: 80}
            - {name: keystone, status: stopped, retry: 80}
            - {name: cinder, status: stopped, retry: 80}
            - {name: horizon, status: stopped, retry: 80}
            - {name: heat, status: stopped, retry: 80}
            - {name: neutron, status: stopped, retry: 80}
            - {name: nova, status: stopped, retry: 80}


        - name: venv-fixer
          image: shaddock/venv-fixer:latest
          priority: 35
          volumes:
            - mount: /opt/openstack
              host_dir: /opt/openstack
          depends-on:
             - {name: symlinkcreator, status: stopped} 
